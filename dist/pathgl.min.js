!function(){function t(e){function n(n){return e=n,W=s(e),q=u(t.vertexShader,t.fragmentShader),c(e),i(e),r(e),d3.timer(T),W?e:null}function r(){W.disable(W.SCISSOR_TEST),W.colorMask(!0,!0,!0,!0),W.stencilMask(1,1,1,1),W.disable(W.BLEND),W.enable(W.CULL_FACE)}function i(t){d3.select(t).on("mousemove.pathgl",o)}function o(){var e=d3.mouse(this);t.uniform("mouse",[P(e[0]),U(e[1])])}function c(t){return O(t,{appendChild:k,querySelectorAll:A,querySelector:function(t){return this.querySelectorAll(t)[0]},removeChild:L,insertBefore:D,gl:W,__scene__:[],__pos__:[],__program__:void 0})}function a(t,e){var n=W.createShader(t);if(W.shaderSource(n,e),W.compileShader(n),!W.getShaderParameter(n,W.COMPILE_STATUS))throw e+" "+W.getShaderInfoLog(n);return n}function u(t,e){if(q=W.createProgram(),t=a(W.VERTEX_SHADER,t),e=a(W.FRAGMENT_SHADER,e),W.attachShader(q,t),W.attachShader(q,e),W.deleteShader(t),W.deleteShader(e),W.linkProgram(q),W.useProgram(q),!W.getProgramParameter(q,W.LINK_STATUS))throw name+": "+W.getProgramInfoLog(q);return $({type:[0],mouse:[0,0]},f),q.vPos=W.getAttribLocation(q,"pos"),W.enableVertexAttribArray(q.vPos),q.vFill=W.getAttribLocation(q,"fill"),W.enableVertexAttribArray(q.vFill),q.vStroke=W.getAttribLocation(q,"stroke"),W.enableVertexAttribArray(q.vStroke),q}function f(t,e){var n,r=W.getUniformLocation(q,e);(q[e]=function(e){n!=e&&(W["uniform"+t.length+"fv"](r,Array.isArray(e)?e:[e]),n=e)})(t)}function s(t){var e=t.getContext("webgl")||t.getContext("experimental-webgl");return e&&O(e,{viewportWidth:t.width,viewportHeight:t.height})}function l(t){var e=[],n=this.buffer,r=this.posBuffer,i=this.indices,o=(n.count,[P(0),U(0)]),c=i.length,a=0,u=[P(0),U(0)];for(t.match(/[a-z][^a-z]*/gi).forEach(function(t){for(var n=t.slice(1).trim().split(/,| /g),r=t[0].toLowerCase(),i=0;i<n.length;){var c=P(n[i++]),a=U(n[i++]);"m"==r?u=o=[c,a]:"l"==r?e.push(o[0],o[1],c,a)&&(o=[c,a]):"z"==r?e.push(o[0],o[1],u[0],u[1])&&(o=u):console.log("%d method is not supported malformed path:",r)}});i.length<e.length;)i.push(n.count+a++);i.length>e.length&&(i.length=e.length),i.forEach(function(t,i){r[3*n[t]+t%3]=i<e.length&&e[i]}),n.count+=e.length-c}function h(){Z(),H.count&&(W.bindBuffer(W.ARRAY_BUFFER,K),W.enableVertexAttribArray(q.vPos),W.bufferData(W.ARRAY_BUFFER,G,W.DYNAMIC_DRAW),W.vertexAttribPointer(q.vPos,4,W.FLOAT,!1,0,0),W.bindBuffer(W.ARRAY_BUFFER,X),W.enableVertexAttribArray(q.vStroke),W.bufferData(W.ARRAY_BUFFER,z,W.DYNAMIC_DRAW),W.vertexAttribPointer(q.vStroke,1,W.FLOAT,!1,0,0),W.bindBuffer(W.ARRAY_BUFFER,J),W.enableVertexAttribArray(q.vFill),W.bufferData(W.ARRAY_BUFFER,z,W.DYNAMIC_DRAW),W.vertexAttribPointer(q.vFill,1,W.FLOAT,!1,0,0),t.uniform("type",1),W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,Q),W.bufferData(W.ELEMENT_ARRAY_BUFFER,H,W.DYNAMIC_DRAW),W.drawElements(W.POINTS,4*H.count,W.UNSIGNED_SHORT,0))}function d(){b1=W.createBuffer(),b2=W.createBuffer(),b3=W.createBuffer(),b4=W.createBuffer()}function p(){ne(),lb.count<1||(W.bindBuffer(W.ARRAY_BUFFER,b1),W.enableVertexAttribArray(q.vPos),W.bufferData(W.ARRAY_BUFFER,ee,W.DYNAMIC_DRAW),W.vertexAttribPointer(q.vPos,2,W.FLOAT,!1,0,0),W.bindBuffer(W.ARRAY_BUFFER,b2),W.enableVertexAttribArray(q.vStroke),W.bufferData(W.ARRAY_BUFFER,z,W.DYNAMIC_DRAW),W.vertexAttribPointer(q.vStroke,1,W.FLOAT,!1,0,0),W.bindBuffer(W.ARRAY_BUFFER,b3),W.enableVertexAttribArray(q.vFill),W.bufferData(W.ARRAY_BUFFER,z,W.DYNAMIC_DRAW),W.vertexAttribPointer(q.vFill,1,W.FLOAT,!1,0,0),t.uniform("type",0),W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,b4),W.bufferData(W.ELEMENT_ARRAY_BUFFER,te,W.DYNAMIC_DRAW),W.drawElements(W.LINES,3*lb.count,W.UNSIGNED_SHORT,0))}function v(){}function A(t,e){return t.replace(/^\s+|\s*([,\s\+\~>]|$)\s*/g,"$1").split(",").forEach(function(t){g(t,this).forEach(V.bind(e=[]))},this)||e}function g(t,e){var n,r=t.split(/[\s\>\+\~](?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),i=t.match(/([\s\>\+\~])(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),o=E(r.pop()),c=[],a=[];return x.call(e,o[1]||"*").forEach(function(t){(n=m.apply(t,o))&&c.push(n)}),r.length?c.forEach(function(t){b(t,r,i)&&a.push(t)})||a:c}function b(t,e,n,r){return r=function i(t,o,c){for(;c=ie[n[o]](c,t);)if(m.apply(c,E(e[o]))&&o)return(r=i(c,o-1,c))?r:c}(t,e.length-1,t)}function m(t,e,n,r,i,o,c,t,a,t,u,f){return a&&re[a]&&!re[a](this,u)||e&&"*"!==e&&this.tag&&this.tag.toLowerCase()!==e||r&&!R(o,this[i]||"",c)||n&&(f=n.match(/#([\w\-]+)/))&&f[1]!==this.id||n&&(n.match(/\.[\w\-]+/g)||[]).some(F.bind(this))?0:this}function R(t,e,n){return e.match(RegExp({"=":n,"^=":"^"+S(n),"$=":S(n)+"$","*=":S(n),"~=":"(?:^|\\s+)"+S(n)+"(?:\\s+|$)","|=":"^"+S(n)+"(-|$)"}[t]||"adnan^"))}function E(t){return t.match(oe)}function y(t){for(;t=t.previousSibling();)if(t.top)return t}function S(t){return t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/,"\\$1")}function F(t){return!RegExp("(^|\\s+)"+t.slice(1)+"(\\s+|$)").test(this.class)}function x(t){return B(this,function(e){return"*"==t||e.tag==t},[])}function B(t,e,n){return(t.__scene__||t.children).forEach(function(t){B(t,e,n),e(t)&&n.push(t)})||n}function w(t){l.call(this,t,this.stroke(this.attr.stroke)),this.stroke(this.attr.stroke)}function D(t,n){var r=e.__scene__,i=r.indexOf(n);reverseEach(r.slice(i,r.push(0)),function(t,e){r[e]=r[e-1]}),r[i]=t}function k(t){return fe[t.tagName.toLowerCase()](t)}function L(t){var e=this.__scene__.indexOf(t);this.__scene__.splice(e,1);for(var n=0;4>n;n++)t.buffer[t.index+n]=0;t.buffer.changed=!0,t.buffer.count-=1}function C(t){return function(n){var r=new t,i=r.buffer;e.__scene__.push(r),r.attr=Object.create(se),r.tag=n.tagName.toLowerCase(),r.parentNode=r.parentElement=e;var o=r.indices="line"==t.name?[i.count,i.count+1]:"circle"==t.name?[4*i.count]:[];return o.forEach(function(t){i[t]=i.count+t%2}),"path"!==t.name&&(i.count+="line"==t.name?2:1),r}}function N(t){he[t]||(d3.select("canvas").on(t,function(){this.__scene__.filter(function(){})}),he[t]=[]),he[t].push(this.id)}function P(t){return 2*(t/e.width)-1}function U(t){return 1-2*(t/e.height)}function T(t){return I(),h(t),p(t),v(t),j&&I()}function I(){W.clear(W.COLOR_BUFFER_BIT|W.DEPTH_BUFFER_BIT|W.STENCIL_BUFFER_BIT)}function Y(){}function O(t,e){if(arguments.length>2)[].forEach.call(arguments,function(e){O(t,e)});else for(var n in e)t[n]=e[n];return t}function M(){return!1}function $(t,e){for(var n in t)e(t[n],n,t)}function V(t){return this.push(t)}var W,q;if(null==e&&(e=document.body.appendChild(O(document.createElement("canvas"),{height:500,width:960}))),e="string"==typeof e?document.querySelector(e):e instanceof d3.selection?e.node():e,!e)return console.log("invalid selector");if(!e.getContext)return console.log(e,"is not a valid canvas");t.vertexShader=["precision mediump float;","uniform float type;","uniform vec2 mouse;","attribute vec4 pos;","attribute float fill;","attribute float stroke;","varying vec4 v_stroke;","varying vec4 v_fill;","varying float v_type;","vec3 unpack_color(float col) {","    if (col == 0.) return vec3(0);","    return vec3(mod(col / 256. / 256., 256.),","                mod(col / 256. , 256.),","                mod(col, 256.)) / 256.; }","void main() {","    gl_Position = vec4(pos.xy, 1., 1.);","    gl_PointSize =  2. * pos.z * (2. *  distance(mouse.xy, pos.xy));","    v_type = (fill > 0. ? 1. : 0.);","    v_fill = vec4(unpack_color(fill), 1.);","    v_stroke = (vec4(unpack_color(stroke), 1.0) * .5) +","        (vec4(distance(mouse.x, pos.x), distance(mouse.y, pos.y), distance(mouse.x, pos.y), 1.) * .5);","}"].join("\n"),t.fragmentShader=["precision mediump float;","uniform float type;","varying vec4 v_stroke;","varying vec4 v_fill;","void main() {","    float dist = distance(gl_PointCoord, vec2(0.5));","    if (type == 1. && dist > 0.5) discard;","    gl_FragColor = v_stroke;","}"].join("\n");var j=!1,z=new Float32Array(15e5);t.uniforms={mouse:[0,0]},t.stop=function(){j=!0},t.uniform=function(t,e){q[t]&&q[t](e)};var H=new Uint16Array(8e4),G=new Float32Array(8e4);H.count=0,pb=H,ppb=G,cb=z;var K,X,J,Q,Z=_.once(function(){K=W.createBuffer(),X=W.createBuffer(),J=W.createBuffer(),Q=W.createBuffer()}),te=new Uint16Array(15e5),ee=new Float32Array(15e5);te.count=0,lb=te,lpb=ee;var ne=_.once(d),re={},ie={" ":function(t){return t&&t!==__scene__&&t.parent()},">":function(t,e){return t&&t.parent()==e.parent()&&t.parent()},"~":function(t){return t&&t.previousSibling()},"+":function(t,e,n,r){return!t||(n=y(t))&&(r=y(e))&&n==r&&n}},oe=/^(\*|\w+)?(?:([\.\#]+[\w\-\.#]+)?)(\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\])?(:([\w\-]+)(\(['"]?([^()]+)['"]?\))?)?/;d3.scale.linear().domain([0,e.width]).range([-1,1]),d3.scale.linear().domain([0,e.height]).range([1,-1]);for(var ce={circle:{r:function(t){this.posBuffer[this.indices[0]+2]=t},cx:function(t){this.posBuffer[this.indices[0]+0]=P(t)},cy:function(t){this.posBuffer[this.indices[0]+1]=U(t)},fill:function(t){var e=d3.rgb(t);z[this.indices[0]/4]=parseInt(e.toString().slice(1),16)},stroke:function(t){return},opacity:function(){},buffer:H,posBuffer:G},ellipse:{cx:Y,cy:Y,rx:Y,ry:Y},rect:{width:Y,height:Y,x:Y,y:Y,rx:ue,ry:ue},image:{"xlink:href":Y,height:Y,width:Y,x:Y,y:Y},line:{x1:function(t){this.posBuffer[2*this.indices[0]]=P(t)},y1:function(t){this.posBuffer[2*this.indices[0]+1]=U(t)},x2:function(t){this.posBuffer[2*this.indices[1]]=P(t)},y2:function(t){this.posBuffer[2*this.indices[1]+1]=U(t)},buffer:te,posBuffer:ee,stroke:function(t){var e=d3.rgb(t);this.indices.forEach(function(t){z[t]=parseInt(e.toString().slice(1),16)})}},path:{d:w,pathLength:Y,buffer:te,posBuffer:ee,stroke:function(t){var e=d3.rgb(t);this.indices.forEach(function(t){z[t/2]=+parseInt(e.toString().slice(1),16)})}},polygon:{points:Y},polyline:{points:Y},g:{appendChild:function(t){this.children.push(k(t))},ctr:function(){this.children=[]}},text:{x:Y,y:Y,dx:Y,dy:Y}},ae=O(Object.create(null),{querySelectorAll:A,children:Object.freeze([]),ctr:C,querySelector:function(t){return this.querySelectorAll(t)[0]},createElementNS:Y,insertBefore:Y,ownerDocument:{createElementNS:Y},render:function(){this.buffer&&drawFill(this),drawStroke(this)},previousSibling:function(){e.scene[e.__scene__.indexOf(this)-1]},nextSibling:function(){e.scene[e.__scene__.indexOf()+1]},parent:function(){return __scene__},fill:function(t){M(t)&&initShader(d3.select(t).text(),t)},transform:function(t){var e=d3.transform(t),n=e.rotate*Math.PI/180;e.rotate&&delete e.translate,O(this.attr,e,{rotation:[Math.sin(n),Math.cos(n)]})},stroke:function(t){M(t)&&initShader(d3.select(t).text(),t)},getAttribute:function(t){return this.attr[t]},setAttribute:function(t,e){this.attr[t]=e,this[t]&&this[t](e)},style:{setProperty:Y},removeAttribute:function(t){delete this.attr[t]},textContent:Y,removeEventListener:Y,addEventListener:N}),ue=Y,fe=[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}].reduce(function(t,e){return t[e.name]=C(e),e.prototype=O(Object.create(ae),ce[e.name]),t},{}),se={rotation:[0,1],translate:[0,0],scale:[1,1],fill:0,stroke:0,"stroke-width":2,cx:0,cy:0,x:0,y:0,opacity:.999},le=0;le<te.length;le+=3)te[le]=le/3,te[le+1]=le/3,te[le+2]=le/3;var he={},de=(Date.now(),{});return t.frameCounter=de,console.log.bind(console),t.xScale=P,t.yScale=U,n(e)}this.pathgl=t,t.stop=d3.functor()}();